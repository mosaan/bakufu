# ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€mapã€filterã€reduceã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãªã©ã®é«˜éšé–¢æ•°ã‚’ä½¿ã£ãŸé–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¯èƒ½ã«ã™ã‚‹ã€å¼·åŠ›ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œæ©Ÿèƒ½ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ†• ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œæ©Ÿèƒ½

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œã¯ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ¦‚å¿µã‚’ä½¿ç”¨ã—ã¦é…åˆ—ã‚„ãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å®£è¨€çš„ã«å‡¦ç†ã™ã‚‹æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ï¼š

- **Map**: AIã‚„ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å„è¦ç´ ã‚’å¤‰æ›
- **Filter**: ç‰¹å®šã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’é¸æŠ
- **Reduce**: è“„ç©ã‚’é€šã˜ã¦è¦ç´ ã‚’å˜ä¸€ã®å€¤ã«é›†ç´„

## ğŸ“ å«ã¾ã‚Œã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### filter-example.yml
**ç›®çš„**: æ¡ä»¶ã«åŸºã¥ãã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³  
**æ©Ÿèƒ½**:
- æ•°å€¤æ¡ä»¶ã«åŸºã¥ãé…åˆ—ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- è¨­å®šå¯èƒ½ãªé–¾å€¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- æ¡ä»¶è©•ä¾¡ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- çµ±è¨ˆæƒ…å ±ä»˜ãJSONå‡ºåŠ›

**ä½¿ç”¨ä¾‹**:
```bash
bakufu run examples/ja/collection-operations/filter-example.yml --input '{
  "numbers": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
  "threshold": 5
}'
```

### map-example.yml
**ç›®çš„**: AIæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ãŸæ„Ÿæƒ…åˆ†æã«ã‚ˆã‚‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å¤‰æ›  
**æ©Ÿèƒ½**:
- ä¸¦è¡Œæ€§åˆ¶å¾¡ã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†
- å„ã‚¢ã‚¤ãƒ†ãƒ ã®AIæ©Ÿèƒ½æ„Ÿæƒ…åˆ†æ
- ãƒãƒƒãƒå‡¦ç†è¨­å®š
- åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- JSONæ§‹é€ åŒ–å‡ºåŠ›

**ä½¿ç”¨ä¾‹**:
```bash
bakufu run examples/ja/collection-operations/map-example.yml --input '{
  "reviews": [
    "ã“ã®å•†å“ã¯ç´ æ™´ã‚‰ã—ã„ï¼å“è³ªãŒè‰¯ãé…é€ã‚‚æ—©ã„ã€‚",
    "ã‚ã¾ã‚Šæ„Ÿå¿ƒã—ãªã„ã€‚å“è³ªãŒæ‚ªãé«˜ã™ãã‚‹ã€‚",
    "ä¾¡æ ¼ã«è¦‹åˆã£ãŸæ™®é€šã®å•†å“ã€‚ãŠã™ã™ã‚ã§ãã‚‹ã€‚"
  ]
}'
```


## ğŸ’¡ æ´»ç”¨ã‚·ãƒ¼ãƒ³

### ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»å‡¦ç†
- **ãƒãƒƒãƒå‡¦ç†**: ä¸¦åˆ—AIåˆ†æã«ã‚ˆã‚‹å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®å‡¦ç†
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: è¤‡é›‘ãªæ¡ä»¶ã«åŸºã¥ããƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **çµ±è¨ˆåˆ†æ**: reduceæ“ä½œã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿é›†ç´„
- **ãƒ‡ãƒ¼ã‚¿å¤‰æ›**: mapæ“ä½œã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿å½¢å¼å¤‰æ›

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‡¦ç†
- **æ„Ÿæƒ…åˆ†æ**: è¤‡æ•°ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã®æ„Ÿæƒ…åˆ†æ
- **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†é¡**: è¤‡æ•°ã®æ–‡æ›¸ã‚„ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†é¡
- **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¦ç´„**: è¤‡æ•°ã®æ–‡æ›¸ã®è¦ç´„ç”Ÿæˆ
- **å“è³ªè©•ä¾¡**: è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¡ç‚¹ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°

### ãƒ“ã‚¸ãƒã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **æˆç¸¾å‡¦ç†**: æ•°å€¤ã‚¹ã‚³ã‚¢ã‹ã‚‰æ–‡å­—è©•ä¾¡ã¸ã®å¤‰æ›
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼åˆ†æ**: é¡§å®¢ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å¤§è¦æ¨¡åˆ†æ
- **ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼**: ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨æ¤œè¨¼
- **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: å‡¦ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## ğŸ”§ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### Mapæ“ä½œ
1ã¤ä»¥ä¸Šã®å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å„è¦ç´ ã‚’å¤‰æ›ã—ã¾ã™ã€‚
```yaml
- id: "transform_data"
  type: "collection"
  operation: "map"
  input: "{{ input_array }}"
  concurrency:
    max_parallel: 3
    batch_size: 5
  steps:
    - id: "process_item"
      type: "ai_call"
      prompt: "ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‡¦ç†: {{ item }}"
```

### Filteræ“ä½œ
æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚
```yaml
- id: "filter_data"
  type: "collection"
  operation: "filter"
  input: "{{ input_array }}"
  condition: "{{ item > threshold }}"
  error_handling:
    on_condition_error: "skip_item"
```

### Reduceæ“ä½œ
è“„ç©ã‚’é€šã˜ã¦è¦ç´ ã‚’å˜ä¸€ã®å€¤ã«é›†ç´„ã—ã¾ã™ã€‚
```yaml
- id: "aggregate_data"
  type: "collection"
  operation: "reduce"
  input: "{{ input_array }}"
  initial_value: ""
  accumulator_var: "acc"
  item_var: "item"
  steps:
    - id: "combine"
      type: "ai_call"
      prompt: "{{ acc }}ã¨{{ item }}ã‚’çµåˆ"
```


## âš™ï¸ è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

### ä¸¦è¡Œæ€§åˆ¶å¾¡
- `max_parallel`: æœ€å¤§ä¸¦åˆ—æ“ä½œæ•°
- `batch_size`: å„ãƒãƒƒãƒã§å‡¦ç†ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ æ•°

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- `on_item_failure`: ã‚¢ã‚¤ãƒ†ãƒ å‡¦ç†å¤±æ•—æ™‚ã®å‡¦ç†æ–¹æ³•ï¼ˆstop/skip/retryï¼‰
- `on_condition_error`: æ¡ä»¶è©•ä¾¡ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†æ–¹æ³•ï¼ˆstop/skip_item/default_falseï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ç‹¬ç«‹ã—ãŸæ“ä½œã«ã¯ä¸¦åˆ—å‡¦ç†ã‚’ä½¿ç”¨
- ãƒ‡ãƒ¼ã‚¿ã«é©ã—ãŸãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’è¨­å®š
- å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã¯ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’è€ƒæ…®