name: "Simple Data Analytics"
description: "CSVå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€åŸºæœ¬çš„ãªçµ±è¨ˆæƒ…å ±ã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’æä¾›ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"

input_parameters:
  - name: "csv_data"
    type: "string"
    required: true
    description: "åˆ†æã™ã‚‹CSVãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’å«ã‚€ï¼‰"
  - name: "analysis_focus"
    type: "string"
    required: false
    description: "åˆ†æã®ç„¦ç‚¹ï¼ˆä¾‹ï¼šå£²ä¸Šå‹•å‘ã€é¡§å®¢åˆ†æã€å‚¾å‘èª¿æŸ»ãªã©ï¼‰"
    default: "ä¸€èˆ¬çš„ãªå‚¾å‘åˆ†æ"

steps:
  - id: "parse_csv_structure"
    type: "ai_call"
    description: "CSVã®æ§‹é€ ã‚’è§£æ"
    prompt: |
      ä»¥ä¸‹ã®CSVãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š

      {{ input.csv_data }}

      ä»¥ä¸‹ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ï¼š
      1. åˆ—æ•°ã¨è¡Œæ•°
      2. å„åˆ—ã®åå‰ã¨ãƒ‡ãƒ¼ã‚¿å‹ã®æ¨å®š
      3. æ¬ æå€¤ã®æœ‰ç„¡
      4. ãƒ‡ãƒ¼ã‚¿ã®å“è³ªï¼ˆä¸€è²«æ€§ã€å½¢å¼ãªã©ï¼‰
      5. åˆ†æã«é©ã—ãŸåˆ—ã®ææ¡ˆ

      JSONå½¢å¼ã§æ§‹é€ åŒ–ã—ã¦è¿”ã—ã¦ãã ã•ã„ã€‚

  - id: "extract_numerical_data"
    type: "text_process"
    description: "æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º"
    method: "regex_extract"
    input: "{{ input.csv_data }}"
    pattern: '(\d+\.?\d*)'
    flags: ["MULTILINE"]
    output_format: "array"

  - id: "calculate_basic_stats"
    type: "ai_call"
    description: "åŸºæœ¬çµ±è¨ˆã‚’è¨ˆç®—"
    prompt: |
      ä»¥ä¸‹ã®CSVãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åŸºæœ¬çµ±è¨ˆã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ï¼š

      {{ input.csv_data }}

      æ•°å€¤ãƒ‡ãƒ¼ã‚¿: {{ steps.extract_numerical_data }}

      è¨ˆç®—ã—ã¦ãã ã•ã„ï¼š
      1. æ•°å€¤åˆ—ã®å¹³å‡ã€ä¸­å¤®å€¤ã€æœ€å¤§å€¤ã€æœ€å°å€¤
      2. ãƒ‡ãƒ¼ã‚¿ã®åˆ†å¸ƒçŠ¶æ³
      3. ç•°å¸¸å€¤ã®æ¤œå‡º
      4. åŸºæœ¬çš„ãªãƒˆãƒ¬ãƒ³ãƒ‰

      åˆ†æçµæœã‚’åˆ†ã‹ã‚Šã‚„ã™ãã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

  - id: "generate_insights"
    type: "ai_call"
    description: "ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ç”Ÿæˆ"
    prompt: |
      åˆ†æãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼š{{ input.analysis_focus }}

      CSVãƒ‡ãƒ¼ã‚¿ï¼š
      {{ input.csv_data }}

      æ§‹é€ åˆ†æï¼š
      {{ steps.parse_csv_structure }}

      åŸºæœ¬çµ±è¨ˆï¼š
      {{ steps.calculate_basic_stats }}

      ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
      1. é‡è¦ãªç™ºè¦‹äº‹é …
      2. æ³¨ç›®ã™ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚„å‚¾å‘
      3. ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç¤ºå”†
      4. æ”¹å–„ææ¡ˆã‚„æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

      å®Ÿç”¨çš„ã§è¡Œå‹•ã«ã¤ãªãŒã‚‹åˆ†æçµæœã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚

  - id: "create_summary"
    type: "text_process"
    description: "ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ"
    method: "replace"
    input: |
      # ğŸ“Š ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

      ## ğŸ“‹ ãƒ‡ãƒ¼ã‚¿æ¦‚è¦
      {{ steps.parse_csv_structure }}

      ## ğŸ“ˆ åŸºæœ¬çµ±è¨ˆ
      {{ steps.calculate_basic_stats }}

      ## ğŸ’¡ ä¸»è¦ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
      {{ steps.generate_insights }}

      ## ğŸ¯ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
      {{ input.analysis_focus }}ã®è¦³ç‚¹ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¨å¥¨ã—ã¾ã™ï¼š
      
      [å…·ä½“çš„ãªæ¨å¥¨äº‹é …ã¯ä¸Šè¨˜ã‚¤ãƒ³ã‚µã‚¤ãƒˆã«åŸºã¥ã]

      ---
      åˆ†æå®Ÿè¡Œæ—¥æ™‚: {{ now().strftime("%Y-%m-%d %H:%M") }}
      ãƒ‡ãƒ¼ã‚¿è¡Œæ•°: {{ input.csv_data.split('\n') | length }}è¡Œ
    replacements:
      - from: "[å…·ä½“çš„ãªæ¨å¥¨äº‹é …ã¯ä¸Šè¨˜ã‚¤ãƒ³ã‚µã‚¤ãƒˆã«åŸºã¥ã]"
        to: "è©³ç´°ã¯ä¸»è¦ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„"

output:
  format: "text"
  template: "{{ steps.create_summary }}"