name: "JSON Data Extractor"
description: "ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰JSONãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã€æŒ‡å®šã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–ã‚Šå‡ºã™ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"

input_parameters:
  - name: "text"
    type: "string"
    required: true
    description: "JSON ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆ"
  - name: "field_path"
    type: "string"
    required: false
    description: "æŠ½å‡ºã—ãŸã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ‘ã‚¹ (ä¾‹: data.items.0.name)"
    default: ""

steps:
  - id: "extract_json"
    type: "text_process"
    description: "ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰JSONã‚’æŠ½å‡º"
    method: "regex_extract"
    input: "{{ input.text }}"
    pattern: '\{[^}]*\}'
    flags: ["MULTILINE", "DOTALL"]
    output_format: "string"

  - id: "parse_json"
    type: "text_process"
    description: "JSONã‚’ãƒ‘ãƒ¼ã‚¹"
    method: "json_parse"
    input: "{{ steps.extract_json }}"

  - id: "extract_field"
    type: "ai_call"
    description: "æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º"
    prompt: |
      ä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ãƒ‘ã‚¹ "{{ input.field_path }}" ã«è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
      
      JSONãƒ‡ãƒ¼ã‚¿:
      {{ steps.parse_json | tojson(indent=2) }}
      
      {% if input.field_path %}
      æŠ½å‡ºãƒ‘ã‚¹: {{ input.field_path }}
      
      æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚ãƒ‘ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" ã¨è¿”ã—ã¦ãã ã•ã„ã€‚
      {% else %}
      ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€å…¨ä½“ã®æ§‹é€ ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
      {% endif %}

  - id: "format_result"
    type: "text_process"
    description: "çµæžœã‚’æ•´å½¢"
    method: "replace"
    input: |
      ðŸ” JSON ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºçµæžœ
      
      ã€å…ƒãƒ‡ãƒ¼ã‚¿ã€‘
      {{ steps.extract_json }}
      
      {% if input.field_path %}
      ã€æŠ½å‡ºãƒ‘ã‚¹ã€‘{{ input.field_path }}
      {% endif %}
      
      ã€æŠ½å‡ºçµæžœã€‘
      {{ steps.extract_field }}
    replacements:
      - from: "{{ steps.extract_json }}"
        to: "{{ steps.extract_json[:100] }}{% if steps.extract_json | length > 100 %}...{% endif %}"

output:
  format: "text"
  template: "{{ steps.format_result }}"