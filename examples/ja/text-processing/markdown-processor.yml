name: "Markdown æ–‡æ›¸å‡¦ç†"
description: "Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’åˆ†æã—ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«è¦ç´„ã‚’ç”Ÿæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"

input_parameters:
  - name: "markdown_text"
    type: "string"
    required: true
    description: "å‡¦ç†ã™ã‚‹Markdownãƒ†ã‚­ã‚¹ãƒˆ"
  - name: "summary_length"
    type: "integer"
    required: false
    description: "å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´„æ–‡å­—æ•°"
    default: 100

steps:
  - id: "split_sections"
    type: "text_process"
    description: "Markdownã‚’ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†å‰²"
    method: "markdown_split"
    input: "{{ input.markdown_text }}"

  - id: "analyze_structure"
    type: "ai_call"
    description: "æ–‡æ›¸æ§‹é€ ã‚’åˆ†æ"
    prompt: |
      ä»¥ä¸‹ã®Markdownæ–‡æ›¸ã®æ§‹é€ ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚
      ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°ã€å…¨ä½“ã®æ–‡å­—æ•°ã€ä¸»è¦ãªãƒˆãƒ”ãƒƒã‚¯ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

      ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§:
      {% for section in steps.split_sections %}
      - {{ section.title or "ã‚¿ã‚¤ãƒˆãƒ«ãªã—" }}: {{ section.content | length }}æ–‡å­—
      {% endfor %}

      ç°¡æ½”ãªåˆ†æçµæœã‚’è¿”ã—ã¦ãã ã•ã„ã€‚

  - id: "summarize_sections"
    type: "ai_call"
    description: "å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦ç´„"
    prompt: |
      ä»¥ä¸‹ã®å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’{{ input.summary_length }}æ–‡å­—ä»¥å†…ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚
      é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚ã¦ã€ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

      {% for section in steps.split_sections %}
      ## ã‚»ã‚¯ã‚·ãƒ§ãƒ³{{ loop.index }}: {{ section.title or "ã‚¿ã‚¤ãƒˆãƒ«ãªã—" }}
      
      å†…å®¹:
      {{ section.content }}
      
      {% endfor %}

      å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´„ã‚’ä»¥ä¸‹ã®å½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š
      
      ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ã€‘ã‚¿ã‚¤ãƒˆãƒ«
      è¦ç´„å†…å®¹...
      
      ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ã€‘æ¬¡ã®ã‚¿ã‚¤ãƒˆãƒ«
      è¦ç´„å†…å®¹...

  - id: "create_toc"
    type: "text_process"
    description: "ç›®æ¬¡ã‚’ä½œæˆ"
    method: "replace"
    input: |
      # ğŸ“‹ æ–‡æ›¸ç›®æ¬¡
      
      {% for section in steps.split_sections %}
      {{ loop.index }}. {{ section.title or "ã‚¿ã‚¤ãƒˆãƒ«ãªã—" }} ({{ section.content | length }}æ–‡å­—)
      {% endfor %}
    replacements:
      - from: "\n\n"
        to: "\n"

output:
  format: "text"
  template: |
    ğŸ“š Markdownæ–‡æ›¸å‡¦ç†çµæœ
    
    {{ steps.create_toc }}
    
    ## ğŸ“Š æ–‡æ›¸åˆ†æ
    {{ steps.analyze_structure }}
    
    ## ğŸ“ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥è¦ç´„
    {{ steps.summarize_sections }}
    
    ---
    å‡¦ç†å®Œäº†: {{ steps.split_sections | length }}ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†ã—ã¾ã—ãŸ